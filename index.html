<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Chúc mừng tình yêu</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: black;
        width: 100%;
        height: 100%;
        touch-action: none;
        -webkit-user-select: none;
        user-select: none;
      }
      canvas {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <canvas id="countdownCanvas" style="z-index: 10"></canvas>
    <canvas id="canvas" style="z-index: 5"></canvas>

    <audio id="myAudio" autoplay loop>
      <source src="phepmau.mp3" type="audio/mpeg" />
      Trình duyệt của bạn không hỗ trợ audio.
    </audio>

    <script>
      const countdownCanvas = document.getElementById("countdownCanvas");
      const ctx = countdownCanvas.getContext("2d");
      countdownCanvas.width = window.innerWidth;
      countdownCanvas.height = window.innerHeight;

      const countdownNumbers = ["3", "2", "1"];
      let countdownIndex = 0;
      let showCountdown = true;
      let fragments = [];
      const W = countdownCanvas.width;
      const H = countdownCanvas.height;

      const messages = [
        "Yêu em, cô gái của tuiii💖",
        "Cảm ơn em vì đã đến bên anh 🍀",
        "19-08-2022",
        "Anh không cần gì nhiều, chỉ cần có em bên cạnh 💞",
        "Nếu yêu em là sai, anh chấp nhận không đúng bao giờ 🥺",
        "Chúc bé luôn xinh đẹp",
        "Anh yêu em nhiều lắm",
        "Gửi ngàn nụ hôn đến người con gái anh yêu 💋",
        "Tình yêu của anh dành cho em ngày càng lớn 🧡",
        "Em là người cuối cùng và duy nhất trong tim anh 💍",
      ];

      function explodeNumber() {
        fragments = [];
        for (let i = 0; i < 30; i++) {
          fragments.push({
            x: W / 2,
            y: H / 2,
            vx: (Math.random() - 0.5) * 10,
            vy: (Math.random() - 0.5) * 10,
            alpha: 1,
            size: 4 + Math.random() * 4,
            color: "white",
          });
        }
      }

      function drawCountdown() {
        ctx.clearRect(0, 0, W, H);
        if (countdownIndex < countdownNumbers.length) {
          ctx.fillStyle = "white";
          ctx.font = "bold 100px Arial";
          ctx.textAlign = "center";
          ctx.fillText(countdownNumbers[countdownIndex], W / 2, H / 2);
          explodeNumber();

          setTimeout(() => {
            countdownIndex++;
            drawCountdown();
          }, 1200);
        } else {
          showCountdown = false;
          showMainMessage();
        }
      }

      function showMainMessage() {
        let message = "Anh yêu em, bé Cún của anh ❤️";
        let index = 0;
        let y = 100;

        const interval = setInterval(() => {
          ctx.clearRect(0, 0, W, H);
          ctx.fillStyle = "white";
          ctx.font = "bold 40px Arial";
          ctx.textAlign = "center";
          ctx.fillText(message.substring(0, index), W / 2, y);

          index++;
          if (index > message.length) {
            clearInterval(interval);
            showMessages();
          }
        }, 100);
      }

      function showMessages() {
        let i = 0;
        const msgYStart = 100;
        const msgSpacing = 60;

        function nextMessage() {
          if (i >= messages.length) return;
          ctx.clearRect(0, 0, W, H);
          ctx.fillStyle = "white";
          ctx.font = "bold 28px Arial";
          ctx.textAlign = "center";
          ctx.fillText(messages[i], W / 2, msgYStart);
          i++;
          setTimeout(nextMessage, 2000);
        }

        nextMessage();
      }

      function animateFragments() {
        ctx.clearRect(0, 0, W, H);
        fragments.forEach((f) => {
          f.x += f.vx;
          f.y += f.vy;
          f.alpha -= 0.02;
          ctx.globalAlpha = f.alpha;
          ctx.fillStyle = f.color;
          ctx.beginPath();
          ctx.arc(f.x, f.y, f.size, 0, 2 * Math.PI);
          ctx.fill();
        });
        ctx.globalAlpha = 1;
        if (showCountdown || fragments.some((f) => f.alpha > 0)) {
          requestAnimationFrame(animateFragments);
        }
      }

      drawCountdown();
      animateFragments();
    </script>
  </body>
</html>
