<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Ch√∫c m·ª´ng t√¨nh y√™u</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: black;
        width: 100%;
        height: 100%;
      }

      canvas {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <canvas id="countdownCanvas" style="z-index: 10"></canvas>
    <canvas id="canvas" style="z-index: 5"></canvas>

    <audio id="myAudio" autoplay loop>
      <source src="phepmau.mp3" type="audio/mpeg" />
      Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ audio.
    </audio>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      const countdownCanvas = document.getElementById("countdownCanvas");
      const countdownCtx = countdownCanvas.getContext("2d");

      let W = window.innerWidth;
      let H = window.innerHeight;
      canvas.width = countdownCanvas.width = W;
      canvas.height = countdownCanvas.height = H;

      window.addEventListener("resize", () => {
        W = canvas.width = countdownCanvas.width = window.innerWidth;
        H = canvas.height = countdownCanvas.height = window.innerHeight;
      });

      document.body.addEventListener("click", () => {
        document.getElementById("myAudio").play();
      });

      const messages = [
        "Y√™u em, c√¥ g√°i c·ªßa tuiiiüíñ",
        "C·∫£m ∆°n em v√¨ ƒë√£ ƒë·∫øn b√™n anh üçÄ",
        "19-08-2022",
        "Anh kh√¥ng c·∫ßn g√¨ nhi·ªÅu, ch·ªâ c·∫ßn c√≥ em b√™n c·∫°nh üíû",
        "N·∫øu y√™u em l√† sai, anh ch·∫•p nh·∫≠n kh√¥ng ƒë√∫ng bao gi·ªù ü•∫",
        "Ch√∫c b√© lu√¥n xinh ƒë·∫πp",
        "Anh y√™u em nhi·ªÅu l·∫Øm",
        "G·ª≠i ng√†n n·ª• h√¥n ƒë·∫øn ng∆∞·ªùi con g√°i anh y√™u üíã",
        "T√¨nh y√™u c·ªßa anh d√†nh cho em ng√†y c√†ng l·ªõn üß°",
        "Em l√† ng∆∞·ªùi cu·ªëi c√πng v√† duy nh·∫•t trong tim anh üíç",
      ];

      const imagePaths = [
        "1.jpg",
        "2.jpg",
        "3.jpg",
        "4.jpg",
        "5.jpg",
        "6.jpg",
        "7.jpg",
        "8.jpg",
        "9.jpg",
        "10.jpg",
        "11.jpg",
        "12.jpg",
        "13.jpg",
        "14.jpg",
        "15.jpg",
        "16.jpg",
        "17.jpg",
        "18.jpg",
        "19.jpg",
        "20.jpg",
      ];

      const loadedImages = [];

      function preloadImages(callback) {
        let loadedCount = 0;
        imagePaths.forEach((src) => {
          const img = new Image();
          img.src = src;
          img.onload = () => {
            loadedImages.push(img);
            if (++loadedCount === imagePaths.length) callback();
          };
        });
      }

      let countdownNumber = 3;
      let fragments = [];
      let countdownFinished = false;
      let isTyping = false;
      let showCountdown = true;

      function explodeNumber() {
        fragments = [];
        for (let i = 0; i < 20; i++) {
          fragments.push({
            x: W / 2,
            y: H / 2,
            vx: (Math.random() - 0.5) * 10,
            vy: (Math.random() - 0.5) * 10,
            alpha: 0.8,
            size: 4 + Math.random() * 4,
            color: "white",
          });
        }
      }

      function drawCountdown() {
        if (!showCountdown || isTyping) return;

        countdownCtx.clearRect(0, 0, W, H);
        if (countdownNumber > 0) {
          countdownCtx.fillStyle = "#ff82c2";
          countdownCtx.shadowColor = "#ffb3ff";
          countdownCtx.shadowBlur = 20;

          let fontSize = Math.floor(W / 2); // ph√π h·ª£p v·ªõi ƒëi·ªán tho·∫°i
          let mainFontSize = Math.floor(W / 18);
          countdownCtx.font = `bold ${mainFontSize}px 'Segoe Script', cursive`;
          countdownCtx.textAlign = "center";
          countdownCtx.textBaseline = "middle";
          countdownCtx.fillText(countdownNumber, W / 2, H / 2);
        }

        for (let f of fragments) {
          countdownCtx.globalAlpha = f.alpha;
          countdownCtx.fillStyle = f.color;
          countdownCtx.beginPath();
          countdownCtx.arc(f.x, f.y, f.size, 0, 2 * Math.PI);
          countdownCtx.fill();
          f.x += f.vx;
          f.y += f.vy;
          f.alpha -= 0.02;
        }
        countdownCtx.globalAlpha = 1;
        requestAnimationFrame(drawCountdown);
      }

      function showLoveMessage() {
        isTyping = true;
        const text = "A y√™u em, b√© C√∫n c·ªßa anh ‚ù§Ô∏è";
        let index = 0;

        countdownCtx.clearRect(0, 0, W, H);
        countdownCtx.font = "bold 42px 'Segoe Script', cursive";
        countdownCtx.fillStyle = "#ff82c2";
        countdownCtx.textAlign = "center";
        countdownCtx.textBaseline = "middle";

        function typeLetter() {
          countdownCtx.clearRect(0, 0, W, H);
          const currentText = text.substring(0, index);
          countdownCtx.fillText(currentText + "|", W / 2, H / 2);

          if (index < text.length) {
            index++;
            setTimeout(typeLetter, 100);
          } else {
            // Khi g√µ xong d√≤ng ƒë·∫ßu ti√™n
            setTimeout(() => {
              countdownCtx.clearRect(0, 0, W, H);
              countdownCtx.fillText(text, W / 2, H / 2);
              // Th√™m d√≤ng 19/08 b√™n d∆∞·ªõi
              let subFontSize = Math.floor(W / 22);
              countdownCtx.font = `bold ${subFontSize}px 'Segoe Script', cursive`;
              countdownCtx.fillText("19/08", W / 2, H / 2 + 50);

              // Sau ƒë√≥ ti·∫øp t·ª•c hi·ªáu ·ª©ng ·∫£nh bay
              setTimeout(() => {
                countdownCtx.clearRect(0, 0, W, H);
                isTyping = false;
                countdownFinished = true;
                createFloatingImages();
                draw();
              }, 1500);
            }, 500);
          }
        }

        typeLetter();
      }

      function startCountdown() {
        let interval = setInterval(() => {
          explodeNumber();
          countdownNumber--;
          if (countdownNumber < 1) {
            clearInterval(interval);
            showCountdown = false;
            setTimeout(() => {
              showLoveMessage();
            }, 1000);
          }
        }, 2000);
        drawCountdown();
      }

      const particles = [];
      const imageObjects = [];

      function randomMessage() {
        return messages[Math.floor(Math.random() * messages.length)];
      }

      function createFloatingImages() {
        const count = 15;
        for (let i = 0; i < count; i++) {
          const img =
            loadedImages[Math.floor(Math.random() * loadedImages.length)];
          imageObjects.push({
            img: img,
            x: Math.random() * W,
            y: H + Math.random() * 200,
            size: W < 500 ? 60 : 80 + Math.random() * 30,
            speedY: 0.8 + Math.random(),
            alpha: 0.8 + Math.random() * 0.4,
          });
        }
      }

      function spawnParticle() {
        const size = Math.floor(W / 25) + Math.random() * 5; // ph√π h·ª£p k√≠ch th∆∞·ªõc nh·ªè
        particles.push({
          x: Math.random() * W,
          y: H + size,
          text: randomMessage().substring(0, 25), // h·∫°n ch·∫ø ƒë·ªô d√†i
          size: size,
          speed: 0.3 + Math.random() * 1.2,
          alpha: 0.9,
        });
      }

      function drawHeart(x, y, size = 6, alpha = 1) {
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.bezierCurveTo(
          x,
          y - size / 2,
          x - size,
          y - size,
          x - size,
          y - 2 * size
        );
        ctx.bezierCurveTo(
          x - size,
          y - 3.5 * size,
          x + size,
          y - 3.5 * size,
          x + size,
          y - 2 * size
        );
        ctx.bezierCurveTo(x + size, y - size, x, y - size / 2, x, y);
        ctx.fillStyle = "pink";
        ctx.fill();
        ctx.restore();
      }

      function draw() {
        ctx.clearRect(0, 0, W, H);
        if (!countdownFinished) return;

        if (Math.random() < 0.1) spawnParticle();

        for (let i = particles.length - 1; i >= 0; i--) {
          const p = particles[i];
          ctx.globalAlpha = p.alpha;
          ctx.font = `${p.size}px sans-serif`;
          ctx.fillStyle = "#ffb3ff";
          ctx.fillText(p.text, p.x, p.y);
          drawHeart(p.x + Math.random() * 30 - 15, p.y - 20, 6, 0.5);

          p.y -= p.speed;
          p.alpha -= 0.003;
          if (p.alpha <= 0) particles.splice(i, 1);
        }

        for (let imgObj of imageObjects) {
          ctx.globalAlpha = imgObj.alpha;
          ctx.drawImage(
            imgObj.img,
            imgObj.x,
            imgObj.y,
            imgObj.size,
            imgObj.size
          );
          imgObj.y -= imgObj.speedY;
          if (imgObj.y + imgObj.size < 0) {
            imgObj.y = H + Math.random() * 100;
            imgObj.x = Math.random() * W;
          }
        }

        requestAnimationFrame(draw);
      }

      preloadImages(() => {
        startCountdown();
      });
    </script>
  </body>
</html>
